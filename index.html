<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Temperature Log</title><script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script><script type="text/javascript" src="http://code.highcharts.com/highcharts.js"></script><script src="http://code.highcharts.com/modules/exporting.js"></script><script type="text/javascript">function getParameterByName(name){name=name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]"); var regex=new RegExp("[\\?&]" + name + "=([^&#]*)"), results=regex.exec(location.search); return results===null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));}jQuery(document).ready(function(){var timeperiod=getParameterByName('timeperiod') var category=getParameterByName('category') // check if category and time period are defined in the query string if (category===""){document.getElementById('container').innerHTML='<center><h1>Select category</h1></center>';}if (timeperiod===""){document.getElementById('container').innerHTML='<center><h1>Select time period</h1></center>';}if (timeperiod==="" && category===""){document.getElementById('container').innerHTML='<center><h1>Select category and time period</h1></center>';}if (!(timeperiod==="" || category==="")){// if category and time period are defined in the query string, check if corresponding file exists $.ajax({url:'./' + category + '-' + timeperiod + '.csv', error: function(){var file_message='<center><h1>File <code>' + category + '-' + timeperiod + '.csv' + '</code> not found</h1></center>'; document.getElementById('container').innerHTML=file_message;}, success: function(){// if corresponding file exists, render it using highcharts var options={chart:{renderTo: 'container',}, title:{text: 'Category: ' + category}, subtitle:{text: 'Time period: ' + timeperiod}, xAxis:{type: 'datetime',}, yAxis:{title:{text: '' // it was a temperature axis before, now it's combined so no axis label}}, series: []}; var names=[]; var timedata=[]; // JQuery function to process the csv data $.get('./' + category + '-' + timeperiod + '.csv', function(data){var lines=data.split('\n'); $.each(lines, function(lineNo, line){// go through csv line by line var items=line.split(','); $.each(items, function(itemNo, item){// go through current line elements if (lineNo==0){// first row contains names if (itemNo > 0){names.push(item); // record all the names}}else{if (itemNo==0){// first column contains time data timedata.push(1000 * parseFloat(item)); // highcharts requires epoch time in milliseconds}}});}); $.each(names, function(nameNo, name){// go through recorded names var series={data: []}; series.name=name; // assign the current name to the current series $.each(lines, function(lineNo, line){// go through csv line by line again var items=line.split(','); $.each(items, function(itemNo, item){// go through current line elements if (nameNo==itemNo - 1){// if num of name col is the same as num of data col, record the data if (lineNo > 0){// first row contains names, dont need it var itemFloat=parseFloat(item); if (isNaN(itemFloat)){// if data is not a number (e.g. 'None') itemFloat=null // then put null variable, so highcharts will ignore this point}series.data.push([timedata[lineNo - 1], itemFloat]); // record combination of [x, y]}}});}); options.series.push(series); // record name and array of [x, y] points}); //putting all together and creating the chart var chart=new Highcharts.Chart(options);});}});}});function insertParam(key, value){key=escape(key); value=escape(value); var kvp=document.location.search.substr(1).split('&'); if (kvp==''){document.location.search='?' + key + '=' + value;}else{var i=kvp.length; var x; while (i--){x=kvp[i].split('='); if (x[0]==key){x[1]=value; kvp[i]=x.join('='); break;}}if (i < 0){kvp[kvp.length]=[key, value].join('=');}//this will reload the page, it's likely better to store this until finished document.location.search=kvp.join('&');}}</script></head><body><hr><table width="100%", style="text-align:center; font-family:'Lucida Grande', 'Lucida Sans Unicode', Arial, Helvetica, sans-serif; font-size:12pt;"><tbody><tr><td>Categories:</td><td><a onclick='insertParam("category", "temperatures");' href="#">temperatures</a></td><td><a onclick='insertParam("category", "network");' href="#">network</a></td><td><a onclick='insertParam("category", "network-slow");' href="#">network-slow</a></td></tr></tbody></table><hr><table width="100%", style="text-align:center; font-family:'Lucida Grande', 'Lucida Sans Unicode', Arial, Helvetica, sans-serif; font-size:12pt;"><tbody><tr><td>Time Periods:</td><td><a onclick='insertParam("timeperiod", "12_hours");' href="#">12_hours</a></td><td><a onclick='insertParam("timeperiod", "2_days");' href="#">2_days</a></td><td><a onclick='insertParam("timeperiod", "7_days");' href="#">7_days</a></td><td><a onclick='insertParam("timeperiod", "1_month");' href="#">1_month</a></td><td><a onclick='insertParam("timeperiod", "3_months");' href="#">3_months</a></td><td><a onclick='insertParam("timeperiod", "1_year");' href="#">1_year</a></td></tr></tbody></table><hr><div id="container" style="width: 100%; height: 500px; margin: 0 auto; font-family:'Lucida Grande', 'Lucida Sans Unicode', Arial, Helvetica, sans-serif; font-size:12pt;"></div></body></html>
